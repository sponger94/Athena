image: microsoft/dotnet:latest

stages:
    - build
    - test
    - deploy

before_script:
    - echo "Creating public directory..."
    - mkdir public
    - echo "Creating badges directory..."
    - mkdir public/badges
    - cd src/ci/

build:pomodoro_api:
    stage: build
    script:
        - "curl https://img.shields.io/badge/Identity.API-failed-red.svg > build.svg"
        - "sh build.sh pomodoro_api"
        - "curl https://img.shields.io/badge/Identity.API-succeeded-success.svg > build.svg"
    allow_failure: true
    artifacts:
        paths:
            - public/badges/pomodoro_api_build.svg
            
build:tasks_api:
    stage: build
    script:
        - sh build.sh tasks_api

test:pomodoro_api:
    stage: test
    script: 
        - sh test.sh pomodoro_api

test:tasks_api:
    stage: test
    script: 
        - sh test.sh tasks_api
        
pages:
  stage: deploy
  script:
    - mkdir .public
    - cp -r * .public
    - mv .public public
  artifacts:
    paths:
      - public
  only:
    - develop